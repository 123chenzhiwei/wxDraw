"use strict";function Watch(){this.startTime=0,this.running=!1,this.goesBytime=0,this.goesBy=void 0,this.DEFAULT_ELASTIC=2}function genExe(t,i,n){console.log("exe",t);if(specialAtrr[i])return specialAtrr[i].getIncre(specialAtrr[i].get(n.Shape.Option[i]),t,!0);if(!isNaN(Number(t)))return n.Shape.Option[i]||0===n.Shape.Option[i]?parseFloat(t)-parseFloat(n.Shape.Option[i]):parseFloat(t)-parseFloat(n.Shape[specialOption[n.type][i]][i]);if(0==t.indexOf("+=")){return t.split("=")[1]}if(0==t.indexOf("-=")){return-1*t.split("=")[1]}}function fakeAnimationFrame(t){var i;setTimeout(function(){i=+new Date,t(i)},16)}function WxDraw(t,i,n,e,s){this.canvas=t,this.wcid=guid(),this.store=new Store,this.bus=new eventBus,this.animation=new Animation(this.bus),this.x=i,this.y=n,this.w=e,this.h=s,this.bus.add("addAnimation",this,this.addAnimationFrag),this.bus.add("update",this,this.update),this.bus.add("getDetectedLayers",this,this.getDetectedLayers),this.bus.add("clearDetectedLayers",this,this.clearDetectedLayers),this.animation.start(),Shape.bus=this.bus,this.detectedLayers=[]}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},asyncGenerator=function(){function t(t){this.value=t}function i(i){function n(t,i){return new Promise(function(n,s){var a={key:t,arg:i,resolve:n,reject:s,next:null};r?r=r.next=a:(o=r=a,e(t,i))})}function e(n,o){try{var r=i[n](o),a=r.value;a instanceof t?Promise.resolve(a.value).then(function(t){e("next",t)},function(t){e("throw",t)}):s(r.done?"return":"normal",r.value)}catch(t){s("throw",t)}}function s(t,i){switch(t){case"return":o.resolve({value:i,done:!0});break;case"throw":o.reject(i);break;default:o.resolve({value:i,done:!1})}o=o.next,o?e(o.key,o.arg):r=null}var o,r;this._invoke=n,"function"!=typeof i.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(t){return this._invoke("next",t)},i.prototype.throw=function(t){return this._invoke("throw",t)},i.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new i(t.apply(this,arguments))}},await:function(i){return new t(i)}}}(),classCallCheck=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,n,e){return n&&t(i.prototype,n),e&&t(i,e),i}}(),_extends=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},toConsumableArray=function(t){if(Array.isArray(t)){for(var i=0,n=Array(t.length);i<t.length;i++)n[i]=t[i];return n}return Array.from(t)},guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)})},util$1={mix:function(t,i,n){t="prototype"in t?t.prototype:t,i="prototype"in i?i.prototype:i,this.extend(t,i,n)},extend:function(t,i){for(var n in t)i.hasOwnProperty(n)&&("object"!=_typeof(i[n])||i[n]instanceof Array?i[n]=t[n]:util$1.extend(t[n],i[n]));return i}},matrixToarray=function(t){var i=[];return t.forEach(function(t){i.push([t[0][0],t[1][0]])}),i},hex2rgb=function(t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},rgb2hex=function(t,i,n){return((1<<24)+(t<<16)+(i<<8)+n).toString(16).substr(1)},Store=function(){this.store=[]};Store.prototype={add:function(t){this.store.push(t)},update:function(){},delete:function(){},getLength:function(){return this.store.length},find:function(t,i){var n=null;return 1==arguments.length&&(n=this.store[t]),2==arguments.length&&this.store.forEach(function(e){e[t]==i&&(n=e)},this),n}};var Matrix=function(){function t(i){classCallCheck(this,t),this.m=i.length,this.n=i[0].length,this.matrixArray=i}return createClass(t,[{key:"multi",value:function(i){var n=[];return i.m==this.n&&(this.matrixArray.forEach(function(t,e){n.push([]);for(var s=0;s<i.n;s++){var o=0;t.forEach(function(t,n){o+=t*i.matrixArray[n][s]}),n[e][s]=o}},this),new t(n))}},{key:"add",value:function(i){var n=[];if(i.m===this.m&&i.n==this.n)return this.matrixArray.forEach(function(t,e){n.push([]),t.forEach(function(t,s){n[e][s]=t+i.matrixArray[e][s]})}),new t(n)}},{key:"sub",value:function(i){var n=[];if(i.m===this.m&&i.n==this.n)return this.matrixArray.forEach(function(t,e){n.push([]),t.forEach(function(t,s){n[e].push(t-i.matrixArray[e][s])})}),new t(n)}}]),t}(),Point=function(){function t(i,n){classCallCheck(this,t),this.x=i,this.y=n}return createClass(t,[{key:"translate",value:function(t,i){this.x+=t,this.y+=i}},{key:"rotate",value:function(t,i){if(t){var n=-t[0]+this.x,e=-t[1]+this.y,s=new Matrix([[t[0]],[t[1]]]),o=new Matrix([[Math.cos(i),-Math.sin(i)],[Math.sin(i),Math.cos(i)]]),r=new Matrix([[n],[e]]);return o.multi(r).add(s).matrixArray}}},{key:"scale",value:function(){}}]),t}(),pOption={x:10,y:10,r:10,sides:7,fillStyle:"#000000",strokeStyle:"#000000",rotate:0,rotateOrigin:null},Polygon=function(t){var i=util$1.extend(t,pOption);console.log(i),this.Option=i,this.max={maxX:null,maxY:null,minX:null,minY:null},this.oriPoints=null,this._Points=[],this.getOriPoints(),this.getMax(this.oriPoints),this._isChoosed=!1,this.rotateOrigin=null};Polygon.prototype={getOriPoints:function(){for(var t=[],i=this.Option.startAngle||0,n=0;n<this.Option.sides;++n)t.push([this.Option.x+this.Option.r*Math.sin(i),this.Option.y-this.Option.r*Math.cos(i)]),i+=2*Math.PI/this.Option.sides;this.oriPoints=t},getPoints:function(){var t=[],i=null;return i=this.rotateOrigin?this.rotateOrigin:[this.Option.x,this.Option.y],this.oriPoints.forEach(function(n){t.push(this.getPointTodraw(n[0],n[1],i))},this),this._Points=matrixToarray(t),this._Points},getMax:function(){var t=this._Points;this.max={maxX:null,maxY:null,minX:null,minY:null},t.forEach(function(t){t[0]>this.max.maxX&&(this.max.maxX=t[0]),this.max.minX||0===this.max.minX||(this.max.minX=t[0]),this.max.minX&&t[0]<this.max.minX&&(this.max.minX=t[0]),t[1]>this.max.maxY&&(this.max.maxY=t[1]),this.max.minY||0===this.max.minY||(this.max.minY=t[1]),this.max.minY&&t[1]<this.max.minY&&(this.max.minY=t[1])},this)},createPath:function(t){var i=this._Points;t.beginPath(),t.moveTo(i[0][0],i[0][1]);for(var n=1;n<this.Option.sides;++n)t.lineTo(i[n][0],i[n][1]);t.closePath()},stroke:function(t){t.save(),this._draw(t),t.setStrokeStyle(this.Option.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),this._draw(t),t.setFillStyle(this.Option.fillStyle),t.fill(),t.restore()},_draw:function(t){this.getOriPoints(),this.getPoints(),this.getMax(),this.createPath(t)},getPointTodraw:function(t,i,n){var e=this.Option.rotate;return new Point(t,i).rotate(n,e)},move:function(t,i){this.Option.x=t,this.Option.y=i},detected:function(t,i){return!!(t>this.max.minX&&t<this.max.maxX&&i>this.max.minY&&i<this.max.maxY&&(this._offsetX=this.Option.x-t,this._offsetY=this.Option.y-i,this._pnpolyTest(t,i)))&&(this._isChoosed=!0,!0)},moveDetect:function(t,i){1==this._isChoosed&&(this.move(t+this._offsetX,i+this._offsetY),this.getOriPoints(),this.getPoints(),this.getMax())},upDetect:function(){this._isChoosed=!1},_pnpolyTest:function(t,i){for(var n=!1,e=0,s=this._Points.length-1;e<this._Points.length;s=e++){var o=this._Points[e][0],r=this._Points[e][1],a=this._Points[s][0],h=this._Points[s][1];r>i!=h>i&&t<(a-o)*(i-r)/(h-r)+o&&(n=!n)}return n},updateOption:function(t){this.Option=util$1.extend(this.Option,t),this.bus.dispatch("update","no")},setRotateOrigin:function(t){this.rotateOrigin=t}};var lOption={strokeStyle:"#000000",points:[[1,2],[23,45],[2,45],[230,205]],rotate:0},Line=function(){function t(i){classCallCheck(this,t);var n=util$1.extend(lOption,i);this.Option=n,this.max={maxX:null,maxY:null,minX:null,minY:null},this.massCenter=this.genMassCenter(this.Option.points),this.posPoints=this.genPointsPositiveLoc(),this.oriPoints=this.Option.points,this._Points=this.Option.points,this.detectPoints=this.getDetectPoints(),this.getMax(),this._isChoosed=!1,this.rotateOrigin=null}return createClass(t,[{key:"genMassCenter",value:function(t){var i=0,n=0;return t.forEach(function(t){i+=t[0],n+=t[1]}),{x:i/t.length,y:n/t.length}}},{key:"getOriPoints",value:function(){var t=[];this.posPoints.forEach(function(i){t.push([this.massCenter.x-i[0],this.massCenter.y-i[1]])},this),this.oriPoints=t}},{key:"genPointsPositiveLoc",value:function(){var t=[];return this.Option.points.forEach(function(i){t.push([this.massCenter.x-i[0],this.massCenter.y-i[1]])},this),t}},{key:"getDetectPoints",value:function(){var t=[],i=[];return this._Points.forEach(function(n,e){0==e||e==this._Points.length-1?t.push(n):(t.push(n),i.shift([n[0],n[1]-5]))},this),t.concat(i)}},{key:"genPoints",value:function(){var t=[],i=null;return i=this.rotateOrigin?this.rotateOrigin:[this.massCenter.x,this.massCenter.y],this.oriPoints.forEach(function(n){t.push(this.getPointTodraw(n[0],n[1],i))},this),this._Points=matrixToarray(t),this._Points}},{key:"getPointTodraw",value:function(t,i,n){var e=this.Option.rotate;return new Point(t,i).rotate(n,e)}},{key:"getMax",value:function(){var t=this._Points;this.max={maxX:null,maxY:null,minX:null,minY:null},t.forEach(function(t){t[0]>this.max.maxX&&(this.max.maxX=t[0]),this.max.minX||0===this.max.minX||(this.max.minX=t[0]),this.max.minX&&t[0]<this.max.minX&&(this.max.minX=t[0]),t[1]>this.max.maxY&&(this.max.maxY=t[1]),this.max.minY||0===this.max.minY||(this.max.minY=t[1]),this.max.minY&&t[1]<this.max.minY&&(this.max.minY=t[1])},this)}},{key:"createPath",value:function(t){var i=this._Points;if(i.length<=0)return!1;t.beginPath(),t.moveTo(i[0][0],i[0][1]);for(var n=1;n<i.length;n++)t.lineTo(i[n][0],i[n][1])}},{key:"stroke",value:function(t){t.save(),this._draw(t),t.setStrokeStyle(this.Option.strokeStyle),t.stroke(),t.restore()}},{key:"fill",value:function(t){this.stroke(t)}},{key:"_draw",value:function(t){this.getOriPoints(),this.genPoints(),this.detectPoints=this.getDetectPoints(),this.getMax(),this.createPath(t)}},{key:"move",value:function(t,i){this.massCenter.x=t,this.massCenter.y=i}},{key:"detected",value:function(t,i){return!!(t>this.max.minX&&t<this.max.maxX&&i>this.max.minY&&i<this.max.maxY&&(this._offsetX=this.massCenter.x-t,this._offsetY=this.massCenter.y-i,this._pnpolyTest(t,i)))&&(this._isChoosed=!0,!0)}},{key:"moveDetect",value:function(t,i){1==this._isChoosed&&(this.move(t+this._offsetX,i+this._offsetY),this.getOriPoints(),this.genPoints(),this.detectPoints=this.getDetectPoints(),this.getMax())}},{key:"upDetect",value:function(){this._isChoosed=!1}},{key:"_pnpolyTest",value:function(t,i){for(var n=!1,e=this.detectPoints,s=0,o=e.length-1;s<e.length;o=s++){var r=e[s][0],a=e[s][1],h=e[o][0],u=e[o][1];a>i!=u>i&&t<(h-r)*(i-a)/(u-a)+r&&(n=!n)}return n}},{key:"updateOption",value:function(t){this.Option=util$1.extend(this.Option,t),this.bus.dispatch("update","no")}},{key:"setRotateOrigin",value:function(t){this.rotateOrigin=t}}]),t}(),commonAttr={lineWidth:12,Shadow:{offsetX:5,offsetY:5,blur:5,color:"#000000"}},commonUnAttr={lineCap:"",lineJoin:"",miterLimit:""},commonMethods={updateOption:function(t){this.Option=util.extend(t,this.Option),this.UnOption=util.extend(t,this.UnOption),this.bus.dispatch("update","no")},upDetect:function(){this._isChoosed=!1},setRotateOrigin:function(t){this.rotateOrigin=t}},cOption=_extends({fillStyle:"#000000",strokeStyle:"red",x:10,y:10,r:10,sA:0,eA:2*Math.PI,counterclockwise:!1,rotate:0},commonAttr),rOption=_extends({x:10,y:10,w:10,h:10,fillStyle:"#000000",strokeStyle:"#000000",rotate:0},commonAttr),Circle=function(t){var i=util$1.extend(t,cOption),n=util$1.extend(t,commonUnAttr);this.Option=i,this.UnOption=n,this._isChoosed=!1,this._offsetX=0,this._offsetY=0,this.rotateOrigin=null};Circle.prototype=_extends({stroke:function(t){t.save(),t.beginPath(),this._draw(t),t.closePath(),t.setStrokeStyle(this.Option.strokeStyle),t.setLineWidth(this.Option.lineWidth),this.Option.Shadow&&t.setShadow(this.Option.Shadow.offsetX,this.Option.Shadow.offsetY,this.Option.Shadow.blur,this.Option.Shadow.color),t.stroke(),t.restore()},fill:function(t){t.save(),t.beginPath(),this._draw(t),t.closePath(),t.setFillStyle(this.Option.fillStyle),this.Option.Shadow&&t.setShadow(this.Option.Shadow.offsetX,this.Option.Shadow.offsetY,this.Option.Shadow.blur,this.Option.Shadow.color),t.fill(),t.restore()},_draw:function(t){this.rotateOrigin?(t.translate(this.rotateOrigin[0],this.rotateOrigin[1]),t.rotate(this.Option.rotate),t.arc(this.Option.x-this.rotateOrigin[0],this.Option.y-this.rotateOrigin[1],this.Option.r,this.Option.sA,this.Option.eA,this.Option.counterclockwise)):(t.translate(this.Option.x,this.Option.y),t.rotate(this.Option.rotate),t.arc(0,0,this.Option.r,this.Option.sA,this.Option.eA,this.Option.counterclockwise))},move:function(t,i){this.Option.x=t,this.Option.y=i},detected:function(t,i){var n=this;if(Math.pow(n.Option.x-t,2)+Math.pow(n.Option.y-i,2)<=Math.pow(n.Option.r,2))return this._offsetX=n.Option.x-t,this._offsetY=n.Option.y-i,this._isChoosed=!0,!0},moveDetect:function(t,i){1==this._isChoosed&&this.move(t+this._offsetX,i+this._offsetY)}},commonMethods);var Rect=function(t){var i=util$1.extend(t,rOption);this.Option=i,this.u,this._isChoosed=!1,this._offsetX=0,this._offsetY=0,this.bus=null,this.rotateOrigin=null,this.oriPoints=[],this._Points=[],this.max={maxX:null,maxY:null,minX:null,minY:null},this.getOriPoints(),this.getPoints(),this.getMax()};Rect.prototype={stroke:function(t){t.save(),t.beginPath(),this._draw(t),t.closePath(),t.setStrokeStyle(this.Option.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),t.beginPath(),this._draw(t),t.closePath(),t.setFillStyle(this.Option.fillStyle),t.fill(),t.restore()},_draw:function(t){this.getOriPoints(),this.getPoints(),this.getMax(),this.createPath(t)},getOriPoints:function(){var t=[];t.push([this.Option.x-this.Option.w/2,this.Option.y-this.Option.h/2]),t.push([this.Option.x-this.Option.w/2,this.Option.y+this.Option.h/2]),t.push([this.Option.x+this.Option.w/2,this.Option.y+this.Option.h/2]),t.push([this.Option.x+this.Option.w/2,this.Option.y-this.Option.h/2]),this.oriPoints=t},getPoints:function(){var t=[],i=null;return i=this.rotateOrigin?this.rotateOrigin:[this.Option.x,this.Option.y],this.oriPoints.forEach(function(n){t.push(this.getPointTodraw(n[0],n[1],i))},this),this._Points=matrixToarray(t),this._Points},getPointTodraw:function(t,i,n){var e=this.Option.rotate;return new Point(t,i).rotate(n,e)},getMax:function(){var t=this._Points;this.max={maxX:null,maxY:null,minX:null,minY:null},t.forEach(function(t){t[0]>this.max.maxX&&(this.max.maxX=t[0]),this.max.minX||0===this.max.minX||(this.max.minX=t[0]),this.max.minX&&t[0]<this.max.minX&&(this.max.minX=t[0]),t[1]>this.max.maxY&&(this.max.maxY=t[1]),this.max.minY||0===this.max.minY||(this.max.minY=t[1]),this.max.minY&&t[1]<this.max.minY&&(this.max.minY=t[1])},this)},createPath:function(t){var i=this._Points;t.beginPath(),t.moveTo(i[0][0],i[0][1]);for(var n=1;n<i.length;++n)t.lineTo(i[n][0],i[n][1]);t.closePath()},_pnpolyTest:function(t,i){for(var n=!1,e=0,s=this._Points.length-1;e<this._Points.length;s=e++){var o=this._Points[e][0],r=this._Points[e][1],a=this._Points[s][0],h=this._Points[s][1];r>i!=h>i&&t<(a-o)*(i-r)/(h-r)+o&&(n=!n)}return n},move:function(t,i){this.Option.x=t,this.Option.y=i},detected:function(t,i){if(t>this.max.minX&&t<this.max.maxX&&i>this.max.minY&&i<this.max.maxY&&(this._offsetX=this.Option.x-t,this._offsetY=this.Option.y-i,this._pnpolyTest(t,i)))return this._isChoosed=!0,!0},moveDetect:function(t,i){1==this._isChoosed&&(this.move(t+this._offsetX,i+this._offsetY),this.getOriPoints(),this.getPoints(),this.getMax())},upDetect:function(){this._isChoosed=!1},updateOption:function(t){this.Option=util$1.extend(t,this.Option),this.bus.dispatch("update","no")},setRotateOrigin:function(t){this.rotateOrigin=t}};var cOption$1={fillStyle:"red",strokeStyle:"red",points:[[145,30],[0,-211],[300,400],[113,50],[30,-31],[3,40],[123,90],[20,-1],[30,60],[131,40],[90,-12],[0,400],[13,6],[70,-17],[30,42]],rotate:0},Cshape=function(t){var i=util$1.extend(t,cOption$1);this.Option=i,this.max={maxX:null,maxY:null,minX:null,minY:null},this.massCenter=this.genMassCenter(this.Option.points),this.posPoints=this.genPointsPositiveLoc(),this.oriPoints=this.Option.points,this._Points=this.Option.points,this.getMax(),this._isChoosed=!1,this.rotateOrigin=null};Cshape.prototype={genPointsPositiveLoc:function(){var t=[];return this.Option.points.forEach(function(i){t.push([this.massCenter.x-i[0],this.massCenter.y-i[1]])},this),t},genMassCenter:function(t){var i=0,n=0;return t.forEach(function(t){i+=t[0],n+=t[1]}),{x:i/t.length,y:n/t.length}},getOriPoints:function(t,i){var n=[];this.posPoints.forEach(function(t){n.push([this.massCenter.x-t[0],this.massCenter.y-t[1]])},this),this.oriPoints=n},genPoints:function(){var t=[],i=null;return i=this.rotateOrigin?this.rotateOrigin:[this.massCenter.x,this.massCenter.y],this.oriPoints.forEach(function(n){t.push(this.getPointTodraw(n[0],n[1],i))},this),this._Points=matrixToarray(t),this._Points},getPointTodraw:function(t,i,n){var e=this.Option.rotate;return new Point(t,i).rotate(n,e)},getMax:function(){var t=this._Points;this.max={maxX:null,maxY:null,minX:null,minY:null},t.forEach(function(t){t[0]>this.max.maxX&&(this.max.maxX=t[0]),this.max.minX||0===this.max.minX||(this.max.minX=t[0]),this.max.minX&&t[0]<this.max.minX&&(this.max.minX=t[0]),t[1]>this.max.maxY&&(this.max.maxY=t[1]),this.max.minY||0===this.max.minY||(this.max.minY=t[1]),this.max.minY&&t[1]<this.max.minY&&(this.max.minY=t[1])},this)},createPath:function(t){var i=this._Points;if(i.length<=0)return!1;t.beginPath(),t.moveTo(i[0][0],i[0][1]);for(var n=1;n<i.length;n++)t.lineTo(i[n][0],i[n][1]);t.closePath()},stroke:function(t){t.save(),this._draw(t),t.setStrokeStyle(this.Option.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),this._draw(t),t.setFillStyle(this.Option.fillStyle),t.fill(),t.restore()},_draw:function(t){this.getOriPoints(),this.genPoints(),this.getMax(),this.createPath(t)},move:function(t,i){this.massCenter.x=t,this.massCenter.y=i},detected:function(t,i){return!!(t>this.max.minX&&t<this.max.maxX&&i>this.max.minY&&i<this.max.maxY&&(this._offsetX=this.massCenter.x-t,this._offsetY=this.massCenter.y-i,this._pnpolyTest(t,i)))&&(this._isChoosed=!0,!0)},moveDetect:function(t,i){1==this._isChoosed&&(this.move(t+this._offsetX,i+this._offsetY),this.getOriPoints(),this.genPoints(),this.getMax())},upDetect:function(){this._isChoosed=!1},_pnpolyTest:function(t,i){for(var n=!1,e=0,s=this._Points.length-1;e<this._Points.length;s=e++){var o=this._Points[e][0],r=this._Points[e][1],a=this._Points[s][0],h=this._Points[s][1];r>i!=h>i&&t<(a-o)*(i-r)/(h-r)+o&&(n=!n)}return n},updateOption:function(t){this.Option=util$1.extend(this.Option,t),this.bus.dispatch("update","no")},setRotateOrigin:function(t){this.rotateOrigin=t}};var EasingFunctions={linear:function(t){return t},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)},easeInOutQuad:function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutCubic:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return-(Math.pow(t-1,4)-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},easeInQuint:function(t){return Math.pow(t,5)},easeOutQuint:function(t){return Math.pow(t-1,5)+1},easeInOutQuint:function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)},easeInSine:function(t){return 1-Math.cos(t*(Math.PI/2))},easeOutSine:function(t){return Math.sin(t*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},easeInCirc:function(t){return-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeOutBounce:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInBack:function(t){var i=1.70158;return t*t*((i+1)*t-i)},easeOutBack:function(t){var i=1.70158;return(t-=1)*t*((i+1)*t+i)+1},easeInOutBack:function(t){var i=1.70158;return(t/=.5)<1?t*t*((1+(i*=1.525))*t-i)*.5:.5*((t-=2)*t*((1+(i*=1.525))*t+i)+2)},elastic:function(t){return-1*Math.pow(4,-8*t)*Math.sin((6*t-1)*(2*Math.PI)/2)+1},swingFromTo:function(t){var i=1.70158;return(t/=.5)<1?t*t*((1+(i*=1.525))*t-i)*.5:.5*((t-=2)*t*((1+(i*=1.525))*t+i)+2)},swingFrom:function(t){var i=1.70158;return t*t*((i+1)*t-i)},swingTo:function(t){var i=1.70158;return(t-=1)*t*((i+1)*t+i)+1},bounce:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bouncePast:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?2-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?2-(7.5625*(t-=2.25/2.75)*t+.9375):2-(7.5625*(t-=2.625/2.75)*t+.984375)},easeFromTo:function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},easeFrom:function(t){return Math.pow(t,4)},easeTo:function(t){return Math.pow(t,.25)}};Watch.prototype={start:function(){this.startTime=+new Date,this.goesBytime=void 0,this.running=!0},stop:function(){this.goesBy=+new Date-this.startTime,this.running=!1},getGoesByTime:function(){if(this.running){var t=+new Date-this.startTime;return t>1&&!isNaN(t)?t:0}return this.goesBy},isRunning:function(){return this.running},reset:function(){this.goesBy=0}};var AnimationTimer=function(t,i){void 0!==t&&(this.duration=t),void 0!==i&&(this.timeFunc=i),this.watch=new Watch};AnimationTimer.prototype={start:function(){this.watch.start()},stop:function(){this.watch.stop()},getGoesByTime:function(){var t=this.watch.getGoesByTime(),i=t/this.duration;if(this.watch.running)return this.timeFunc?t*(EasingFunctions[this.timeFunc](i)/i):t},isOver:function(){return this.watch.getGoesByTime()>this.duration}};var specialOption={cshape:{x:"massCenter",y:"massCenter"},line:{x:"massCenter",y:"massCenter"}},specialAtrr={fillStyle:{get:function(t){return hex2rgb(t)},set:function(t,i,n){var e=[t.r+Math.floor(i.r*n),t.g+Math.floor(i.g*n),t.b+Math.floor(i.b*n)];return"#"+rgb2hex.apply(void 0,e)},getIncre:function(t,i,n){if(n){var e=hex2rgb(i);return{r:e.r-t.r,g:e.g-t.g,b:e.b-t.b}}}},strokeStyle:{get:function(t){return hex2rgb(t)},set:function(t,i,n){var e=[t.r+Math.floor(i.r*n),t.g+Math.floor(i.g*n),t.b+Math.floor(i.b*n)];return"#"+rgb2hex.apply(void 0,e)},getIncre:function(t,i,n){if(n){var e=hex2rgb(i);return{r:e.r-t.r,g:e.g-t.g,b:e.b-t.b}}}},Shadow:{get:function(t){return{offsetX:t.offsetX,offsetY:t.offsetY,blur:t.blur,color:hex2rgb(t.color)}},set:function(t,i,n){var e="#"+rgb2hex.apply(void 0,toConsumableArray(temCo));return{offsetX:t.offsetX+i.offsetX*n,offsetY:t.offsetY+i.offsetY*n,blur:t.blur+i.blur*n,color:e}},getIncre:function(t,i,n){var e=hex2rgb(i.color);console.log("ssssss",t);var s={r:e.r-t.color.r,g:e.g-t.color.g,b:e.b-t.color.b};return{offsetX:i.offsetX-t.offsetX,offsetY:i.offsetY-t.offsetY,blur:i.blur-t.blur,color:s}}}},FRAGOPTION={onStart:function(){},onLooping:function(){},onEnd:function(){},duration:1e3,easing:"linear"},AnimationFrag=function(t,i,n,e,s){var o=util$1.extend(e,FRAGOPTION);this.object=t,this.source=0,this.genFlag=!1,this.bus=s,this.complete=!1,this.running=!1,this.started=!1,this.duration=o.duration,this.atrribute=i,this.atrributeList=[],"object"==(void 0===i?"undefined":_typeof(i))?(this.genFlag=!0,this.genAtrributeList(i)):(this.incre=genExe(n,i,t),this.exe=n),this.timer=new AnimationTimer(o.duration,o.easing),this.oriOption=o,this.endCallFrag=null,this.onEnd=o.onEnd,this.onLooping=o.onLooping,this.onStart=o.onStart,this._aniWrapbus=null};AnimationFrag.prototype={updateAnimation:function(){return!this.complete&&(this.timer.isOver()?(this.onEnd(),this.complete=!0,this.running=!1,this._aniWrapbus.dispatch("fragAniOver","no","me"),!1):void(this.started||this.complete?(this.onLooping(),this.updateAtrribute()):(this.genFlag||(this.source=this.object.Shape.Option[this.atrribute]||0==this.object.Shape.Option[this.atrribute]?this.object.Shape.Option[this.atrribute]:this.object.Shape[specialOption[this.object.type][this.atrribute]][this.atrribute],specialAtrr[this.atrribute]&&(this.source=specialAtrr[this.atrribute].get(this.object.Shape.Option[this.atrribute]))),this.started=!0,this.running=!0,this.onStart(),this.timer.start())))},updateAtrribute:function(){this.genFlag?this.atrributeList.forEach(function(t){this.object.Shape.Option[t.attr]||0==this.object.Shape.Option[t.attr]?specialAtrr[t.attr]?this.object.Shape.Option[t.attr]=specialAtrr[t.attr].set(t.source,t.incre,this.timer.getGoesByTime()/this.duration):this.object.Shape.Option[t.attr]=t.source+t.incre*this.timer.getGoesByTime()/this.duration:this.object.Shape[specialOption[this.object.type][t.attr]][t.attr]=t.source+t.incre*this.timer.getGoesByTime()/this.duration},this):this.object.Shape.Option[this.atrribute]||0==this.object.Shape.Option[this.atrribute]?specialAtrr[this.atrribute]?this.object.Shape.Option[this.atrribute]=specialAtrr[this.atrribute].set(this.source,this.incre,this.timer.getGoesByTime()/this.duration):this.object.Shape.Option[this.atrribute]=this.source+this.incre*this.timer.getGoesByTime()/this.duration:this.object.Shape[specialOption[this.object.type][this.atrribute]][this.atrribute]=this.source+this.incre*this.timer.getGoesByTime()/this.duration},genAtrributeList:function(t){var i=Object.keys(t),n=this;i.forEach(function(i){var e=this.object.Shape.Option[i]||0==this.object.Shape.Option[i]?this.object.Shape.Option[i]:this.object.Shape[specialOption[this.object.type][i]][i];specialAtrr[i]&&(e=specialAtrr[i].get(this.object.Shape.Option[i])),n.atrributeList.push({attr:i,incre:genExe(t[i],i,n.object),source:e})},this)},updateSourceAndtarget:function(){this.genFlag?this.genAtrributeList(this.atrribute):(this.source=this.object.Shape.Option[this.atrribute]||0==this.object.Shape.Option[this.atrribute]?this.object.Shape.Option[this.atrribute]:this.object.Shape[specialOption[this.object.type][this.atrribute]][this.atrribute],specialAtrr[this.atrribute]&&(this.source=specialAtrr[this.atrribute].get(this.object.Shape.Option[this.atrribute])),this.incre=genExe(this.exe,this.atrribute,this.object))},addWrapBus:function(t){this._aniWrapbus=t},restart:function(){this.complete=!1,this.running=!1,this.started=!1,this.timer=new AnimationTimer(this.oriOption.duration,this.oriOption.easing)}};var eventBus=function(){this.eventList=[]};eventBus.prototype={add:function(t,i,n){this.eventList.length?(this.eventList.forEach(function(i){if(i.name==t)return i.thingsList.push(n),!1},this),this.eventList.push({name:t,scope:i,thingsList:[n]})):this.eventList.push({name:t,scope:i,thingsList:[n]})},dispatch:function(t,i){var n=arguments;if(arguments.length<2)return!1;var e=Array.prototype.slice.call(n,2);this.eventList.forEach(function(n){n.name===t&&n.thingsList.forEach(function(t){"no"!==i?t.call.apply(t,[i].concat(toConsumableArray(e))):t.call.apply(t,[n.scope].concat(toConsumableArray(e)))})})},destroy:function(){}};var AniFragWrap=function(t,i,n){this.runing=!1,this.stoped=!1,this.started=!1,this.fragStore=[],this.animationPick=0,this.bus=t,this.aniFraBus=new eventBus,this.aniFraBus.add("fragAniOver",this,this.getAniOver),this.overAni=[],this.aniFragListId=i,this.loop=!1,this.loopTimes=!1,this.looped=0,this.object=n,this.oriOption=util$1.extend({},n.Shape.Option),this.endCallWraper=null,this.firstTime=!0};AniFragWrap.prototype={updateFrag:function(t){t.addWrapBus(this.aniFraBus),this.fragStore.length?(this.fragStore[this.fragStore.length-1].endCallFrag=t,this.fragStore.push(t)):this.fragStore.push(t)},exeAnimate:function(){if(this.firstTime&&(this.firstTime=!1,this.oriOption=util$1.extend({},this.object.Shape.Option)),this.stoped)return this.endCallWraper&&this.endCallWraper.exeAnimate(),!1;this.fragStore[this.animationPick]&&this.fragStore[this.animationPick].updateAnimation()},getAniOver:function(t){if(this.overAni.push(t),this.overAni.length==this.fragStore.length){if(this.loop){if(this.loopTimes&&this.looped<=this.loopTimes&&this.looped++,this.loopTimes&&this.looped>this.loopTimes)return this.stop(),!1;this.restart()}else this.stop();return!1}this.animationPick++,this.fragStore[this.animationPick].updateSourceAndtarget()},restart:function(){this.object.updateOption(this.oriOption),this.overAni=[],this.animationPick=0,this.fragStore.forEach(function(t){t.restart()},this),this.started=!1,this.stoped=!1,this.firstTime=!0},stop:function(){this.stoped=!0,this.bus.dispatch("wraperAniComplete","no",this.aniFragListId,this.object.Shapeid)},resume:function(){},setLoop:function(t,i){this.loop=t||!1,this.loopTimes=i||!1,this.looped=1}};var Shape=function(t,i,n,e,s){this.draggable=!!e,this.highlight=!!s,this.strokeOrfill=!!n,this.type=t,this.Shape=new shapeTypes[t](i),this.AnimationTimer=new AnimationTimer,this.animtionFragList=[],this.bus=null,this.Shapeid="sp"+guid(),this.animationStart=!1,this.aniFragListId="",this.aniFragWraper=null,this._layerIndex=0,this._getChoosed=!1};Shape.prototype={updateBus:function(t){this.bus=t},paint:function(t){this.strokeOrfill?this.Shape.fill(t):this.Shape.stroke(t)},detect:function(t,i){this.Shape.detected(t,i),this.Shape.detected(t,i)?this.bus.dispatch("getDetectedLayers","no",this._layerIndex):this.bus.dispatch("getDetectedLayers","no",-1)},moveDetect:function(t,i){this.draggable&&this._getChoosed&&this.Shape.moveDetect(t,i)},upDetect:function(){this._getChoosed&&(this.bus.dispatch("clearDetectedLayers","no"),this.Shape.upDetect(),this._getChoosed=!1)},animate:function(t,i,n){this.aniFragListId||(this.aniFragListId="af"+guid(),this.aniFragWraper=new AniFragWrap(this.bus,this.aniFragListId,this));var e=null;return e="object"==(void 0===t?"undefined":_typeof(t))?new AnimationFrag(this,t,"no",arguments[1],this.bus):new AnimationFrag(this,t,arguments[1],arguments[2],this.bus),this.aniFragWraper.updateFrag(e),this},start:function(t){this.animationStart=!0,this.aniFragWraper&&(!0===t&&this.aniFragWraper.setLoop(t),"number"==typeof t&&this.aniFragWraper.setLoop(!0,t),this.bus.dispatch("addAnimation","no",this.aniFragWraper,this.Shapeid),this.aniFragListId="",this.aniFragWraper=null)},updateOption:function(t){return this.Shape.bus||(this.Shape.bus=this.bus),this.Shape.updateOption(t),this},setOrigin:function(t){return this.Shape.setRotateOrigin(t),this},updateLayer:function(t){this._layerIndex=t},getChoosed:function(){this._getChoosed=!0}};var shapeTypes={circle:function(t){return new Circle(t)},rect:function(t){return new Rect(t)},polygon:function(t){return new Polygon(t)},cshape:function(t){return new Cshape(t)},line:function(t){return new Line(t)}},AnimationFrame=function(){return"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:fakeAnimationFrame},animationFrame=AnimationFrame(),Animation=function(t){this.running=!1,this.paused=!0,this.bus=t,this.animationFragStore={},this.animationCompleteList=[],this.wraperAniCompleteOb={},this.bus.add("animationComplete",this,this.animationComplete),this.bus.add("wraperAniComplete",this,this.wraperAniComplete)};Animation.prototype={start:function(){this.running=!0,
this.loopAnimation()},loopAnimation:function(){function t(){animationFrame(t),i.running&&i.updateStep()}var i=this;animationFrame(t)},updateStep:function(){Object.keys(this.animationFragStore).forEach(function(t){this.animationFragStore[t][0].exeAnimate()},this),this.bus.dispatch("update","no")},animationComplete:function(t){this.animationCompleteList.push(t),Object.keys(this.wraperAniCompleteOb).length===Object.keys(this.animationFragStore).length&&(this.running=!1)},wraperAniComplete:function(t,i){this.wraperAniCompleteOb[i]?this.wraperAniCompleteOb[i].push(t):this.wraperAniCompleteOb[i]=[t],this.wraperAniCompleteOb[i].length==this.animationFragStore[i].length&&this.bus.dispatch("animationComplete","no",i)}},WxDraw.prototype={add:function(t){t.updateBus(this.bus),t.updateLayer(this.store.getLength()),this.store.add(t)},draw:function(){this.store.store.forEach(function(t){t.paint(this.canvas)},this)},detect:function(t){var i=this.getLoc(t.touches[0].x,t.touches[0].y);this.store.store.forEach(function(t){t.detect(i.x,i.y)},this)},moveDetect:function(t){var i=this.getLoc(t.touches[0].x,t.touches[0].y);this.store.store.forEach(function(t){t.moveDetect(i.x,i.y)},this),this.draw(),this.canvas.draw()},upDetect:function(){this.store.store.forEach(function(t){t.upDetect()},this)},getLoc:function(t,i){return{x:t-this.x>0?t-this.x>this.w?this.w:t-this.x:this.x,y:i-this.y>0?i-this.y>this.h?this.h:i-this.y:this.y}},update:function(){this.draw(),this.canvas.draw()},AnimationCenter:function(){},addAnimationFrag:function(t,i){this.animation.animationFragStore[i]?(this.animation.animationFragStore[i][this.animation.animationFragStore[i].length-1].endCallWraper=t,this.animation.animationFragStore[i].push(t)):this.animation.animationFragStore[i]=[t]},getDetectedLayers:function(t){this.detectedLayers.push(t),this.detectedLayers.length==this.store.getLength()&&-1!=Math.max.apply(null,this.detectedLayers)&&this.store.find(Math.max.apply(null,this.detectedLayers)).getChoosed(),this.detectedLayers.length==this.store.getLength()&&-1==Math.max.apply(null,this.detectedLayers)&&this.clearDetectedLayers()},clearDetectedLayers:function(){this.detectedLayers=[]}};var wxDraw={WxDraw:WxDraw,Shape:Shape,AnimationFrame:AnimationFrame()};module.exports=wxDraw;
