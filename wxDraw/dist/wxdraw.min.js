"use strict";function Point(t,s){this.x=t,this.y=s}function WxDraw(t,s,i,e,h){this.canvas=t,this.wcid=_guid(),this.store=new Store,this.x=s,this.y=i,this.w=e,this.h=h}var pOption={x:10,y:10,r:10,sides:7,fillStyle:"red",strokeStyle:"red"},util=require("../util/utils.js").util,Polygon=function(t){var s=util.extend(t,pOption);this.x=s.x,this.y=s.y,this.x=s.x,this.radius=s.r,this.sides=s.sides,this.max={maxX:0,maxY:0,minX:0,minY:0},this.points=this.getPoints(),this.fillStyle=s.fillStyle,this.strokeStyle=s.strokeStyle,this._isChoosed=!1};Polygon.prototype={getPoints:function(){var t=[],s=this.startAngle||0;this.max={maxX:0,maxY:0,minX:0,minY:0};for(var i=0;i<this.sides;++i)t.push(new Point(this.x+this.radius*Math.sin(s),this.y-this.radius*Math.cos(s))),this.x+this.radius*Math.sin(s)>this.max.maxX&&(this.max.maxX=this.x+this.radius*Math.sin(s)),this.max.minX||(this.max.minX=this.x+this.radius*Math.sin(s)),this.max.minX&&this.x+this.radius*Math.sin(s)<this.max.minX&&(this.max.minX=this.x+this.radius*Math.sin(s)),this.y+this.radius*Math.sin(s)>this.max.maxY&&(this.max.maxY=this.y+this.radius*Math.sin(s)),this.max.minY||(this.max.minY=this.y+this.radius*Math.sin(s)),this.max.minY&&this.y+this.radius*Math.sin(s)<this.max.minY&&(this.max.minY=this.y+this.radius*Math.sin(s)),s+=2*Math.PI/this.sides;return t},createPath:function(t){var s=this.getPoints();t.beginPath(),t.moveTo(s[0].x,s[0].y);for(var i=1;i<this.sides;++i)t.lineTo(s[i].x,s[i].y);t.closePath()},stroke:function(t){t.save(),this.createPath(t),t.setStrokeStyle(this.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),this.createPath(t),t.setStrokeStyle(this.fillStyle),t.fill(),t.restore()},move:function(t,s){this.x=t,this.y=s},detected:function(t,s){t>this.max.minX&&t<this.max.maxX&&s>this.max.minY&&s<this.max.maxY&&(this.points=this.getPoints(),this._offsetX=this.x-t,this._offsetY=this.y-s,this._pnpolyTest(t,s)&&(this._isChoosed=!0))},moveDetect:function(t,s){1==this._isChoosed&&this.move(t+this._offsetX,s+this._offsetY)},upDetect:function(){this._isChoosed=!1},_pnpolyTest:function(t,s){for(var i=!1,e=0,h=this.points.length-1;e<this.points.length;h=e++){var o=this.points[e].x,n=this.points[e].y,r=this.points[h].x,a=this.points[h].y;n>s!=a>s&&t<(r-o)*(s-n)/(a-n)+o&&(i=!i)}return console.log(i),i}};var cOption={fillStyle:"red",strokeStyle:"red",x:10,y:10,r:10,sA:0,eA:2*Math.PI,counterclockwise:!1},rOption={x:10,y:10,w:10,h:10,fillStyle:"red",strokeStyle:"red"},util$1=require("../util/utils.js").util,Circle=function(t){var s=util$1.extend(t,cOption);console.log("_temOption",s),this.x=s.x,this.y=s.y,this.r=s.r,this.sA=s.sA,this.eA=s.eA,this.counterclockwise=s.counterclockwise,this.fillStyle=s.fillStyle,this.strokeStyle=s.strokeStyle,this._isChoosed=!1,this._offsetX=0,this._offsetY=0};Circle.prototype={stroke:function(t){t.save(),t.beginPath(),t.arc(this.x,this.y,this.r,this.sA,this.eA,this.counterclockwise),t.closePath(),t.setStrokeStyle(this.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),t.beginPath(),t.arc(this.x,this.y,this.r,this.sA,this.eA,this.counterclockwise),t.closePath(),t.setFillStyle(this.fillStyle),t.fill(),t.restore()},move:function(t,s){this.x=t,this.y=s},detected:function(t,s){var i=this;if(Math.pow(i.x-t,2)+Math.pow(i.y-s,2)<=Math.pow(i.r,2))return this._offsetX=i.x-t,this._offsetY=i.y-s,console.log("x",this._offsetX),console.log("y",this._offsetY),this._isChoosed=!0,!0},moveDetect:function(t,s){1==this._isChoosed&&this.move(t+this._offsetX,s+this._offsetY)},upDetect:function(){this._isChoosed=!1}};var Rect=function(t){var s=util$1.extend(t,rOption);console.log(s),this.x=s.x,this.y=s.y,this.w=s.w,this.h=s.h,this.fillStyle=s.fillStyle,this.strokeStyle=s.strokeStyle,this._isChoosed=!1,this._offsetX=0,this._offsetY=0};Rect.prototype={stroke:function(t){t.save(),t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.closePath(),t.setStrokeStyle(this.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.closePath(),t.setFillStyle(this.fillStyle),t.fill(),t.restore()},move:function(t,s){this.x=t,this.y=s},detected:function(t,s){var i=this;if(i.x<t&&i.y<s&&i.y+i.h>s&&i.x+i.w>t)return this._offsetX=t-i.x,this._offsetY=s-i.y,console.log("移动方块"),this._isChoosed=!0,!0},moveDetect:function(t,s){1==this._isChoosed&&this.move(t-this._offsetX,s-this._offsetY)},upDetect:function(){this._isChoosed=!1}};var ShapeBase=require("./shapeBase.js").ShapeBase,Shape=function(t,s,i,e,h){this.draggable=!!e,this.highlight=!!h,this.strokeOrfill=!!i,this.type=t,this.Shape=new shapeTypes[t](s)};Shape.prototype={paint:function(t){this.strokeOrfill?this.Shape.fill(t):this.Shape.stroke(t)},detect:function(t,s){this.Shape.detected(t,s),this.Shape.detected(t,s)},moveDetect:function(t,s){this.Shape.moveDetect(t,s)},upDetect:function(){this.Shape.upDetect()}};var shapeTypes={circle:function(t){return new Circle(t)},rect:function(t){return new Rect(t)},polygon:function(t){return new Polygon(t)}},_guid=require("./util/utils.js")._guid,Store=require("./store/store.js").Store;WxDraw.prototype={add:function(t){this.store.add(t)},draw:function(){this.store.store.forEach(function(t){t.paint(this.canvas)},this)},detect:function(t){var s=this.getLoc(t.touches[0].x,t.touches[0].y);this.store.store.forEach(function(t){t.detect(s.x,s.y)},this)},moveDetect:function(t){var s=this.getLoc(t.touches[0].x,t.touches[0].y);this.store.store.forEach(function(t){t.moveDetect(s.x,s.y),console.log("item",t)},this),this.draw(),this.canvas.draw()},upDetect:function(){this.store.store.forEach(function(t){t.upDetect()},this)},getLoc:function(t,s){return{x:t-this.x>0?t-this.x>this.w?this.w:t-this.x:this.x,y:s-this.y>0?s-this.y>this.h?this.h:s-this.y:this.y}}},module.exports={WxDraw:WxDraw,Shape:Shape};
