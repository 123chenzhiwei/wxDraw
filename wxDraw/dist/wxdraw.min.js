"use strict";function Point(t,i){this.x=t,this.y=i}function fakeAnimationFrame(t){var i,s;setTimeout(function(){i=+new Date,t(i),s=+new Date,console.log(s-i)},16)}function WxDraw(t,i,s,e,h){this.canvas=t,this.wcid=guid(),this.store=new Store,this.x=i,this.y=s,this.w=e,this.h=h}var guid=function(){var t=9707740;return function(){return t++}},util={mix:function(t,i,s){t="prototype"in t?t.prototype:t,i="prototype"in i?i.prototype:i,this.extend(t,i,s)},extend:function(t,i,s){for(var e in i)i.hasOwnProperty(e)&&(s?null!=i[e]:null==t[e])&&(t[e]=i[e]);return t}},Store=function(){this.store=[]};Store.prototype={add:function(t){this.store.push(t)},update:function(){},delete:function(){}};var pOption={x:10,y:10,r:10,sides:7,fillStyle:"red",strokeStyle:"red"},Polygon=function(t){var i=util.extend(t,pOption);this.x=i.x,this.y=i.y,this.x=i.x,this.radius=i.r,this.sides=i.sides,this.max={maxX:0,maxY:0,minX:0,minY:0},this.points=this.getPoints(),this.fillStyle=i.fillStyle,this.strokeStyle=i.strokeStyle,this._isChoosed=!1};Polygon.prototype={getPoints:function(){var t=[],i=this.startAngle||0;this.max={maxX:0,maxY:0,minX:0,minY:0};for(var s=0;s<this.sides;++s)t.push(new Point(this.x+this.radius*Math.sin(i),this.y-this.radius*Math.cos(i))),this.x+this.radius*Math.sin(i)>this.max.maxX&&(this.max.maxX=this.x+this.radius*Math.sin(i)),this.max.minX||(this.max.minX=this.x+this.radius*Math.sin(i)),this.max.minX&&this.x+this.radius*Math.sin(i)<this.max.minX&&(this.max.minX=this.x+this.radius*Math.sin(i)),this.y+this.radius*Math.sin(i)>this.max.maxY&&(this.max.maxY=this.y+this.radius*Math.sin(i)),this.max.minY||(this.max.minY=this.y+this.radius*Math.sin(i)),this.max.minY&&this.y+this.radius*Math.sin(i)<this.max.minY&&(this.max.minY=this.y+this.radius*Math.sin(i)),i+=2*Math.PI/this.sides;return t},createPath:function(t){var i=this.getPoints();t.beginPath(),t.moveTo(i[0].x,i[0].y);for(var s=1;s<this.sides;++s)t.lineTo(i[s].x,i[s].y);t.closePath()},stroke:function(t){t.save(),this.createPath(t),t.setStrokeStyle(this.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),this.createPath(t),t.setStrokeStyle(this.fillStyle),t.fill(),t.restore()},move:function(t,i){this.x=t,this.y=i},detected:function(t,i){t>this.max.minX&&t<this.max.maxX&&i>this.max.minY&&i<this.max.maxY&&(this.points=this.getPoints(),this._offsetX=this.x-t,this._offsetY=this.y-i,this._pnpolyTest(t,i)&&(this._isChoosed=!0))},moveDetect:function(t,i){1==this._isChoosed&&this.move(t+this._offsetX,i+this._offsetY)},upDetect:function(){this._isChoosed=!1},_pnpolyTest:function(t,i){for(var s=!1,e=0,h=this.points.length-1;e<this.points.length;h=e++){var o=this.points[e].x,n=this.points[e].y,r=this.points[h].x,a=this.points[h].y;n>i!=a>i&&t<(r-o)*(i-n)/(a-n)+o&&(s=!s)}return console.log(s),s}};var cOption={fillStyle:"red",strokeStyle:"red",x:10,y:10,r:10,sA:0,eA:2*Math.PI,counterclockwise:!1},rOption={x:10,y:10,w:10,h:10,fillStyle:"red",strokeStyle:"red"},Circle=function(t){var i=util.extend(t,cOption);console.log("_temOption",i),this.x=i.x,this.y=i.y,this.r=i.r,this.sA=i.sA,this.eA=i.eA,this.counterclockwise=i.counterclockwise,this.fillStyle=i.fillStyle,this.strokeStyle=i.strokeStyle,this._isChoosed=!1,this._offsetX=0,this._offsetY=0};Circle.prototype={stroke:function(t){t.save(),t.beginPath(),t.arc(this.x,this.y,this.r,this.sA,this.eA,this.counterclockwise),t.closePath(),t.setStrokeStyle(this.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),t.beginPath(),t.arc(this.x,this.y,this.r,this.sA,this.eA,this.counterclockwise),t.closePath(),t.setFillStyle(this.fillStyle),t.fill(),t.restore()},move:function(t,i){this.x=t,this.y=i},detected:function(t,i){var s=this;if(Math.pow(s.x-t,2)+Math.pow(s.y-i,2)<=Math.pow(s.r,2))return this._offsetX=s.x-t,this._offsetY=s.y-i,console.log("x",this._offsetX),console.log("y",this._offsetY),this._isChoosed=!0,!0},moveDetect:function(t,i){1==this._isChoosed&&this.move(t+this._offsetX,i+this._offsetY)},upDetect:function(){this._isChoosed=!1}};var Rect=function(t){var i=util.extend(t,rOption);console.log(i),this.x=i.x,this.y=i.y,this.w=i.w,this.h=i.h,this.fillStyle=i.fillStyle,this.strokeStyle=i.strokeStyle,this._isChoosed=!1,this._offsetX=0,this._offsetY=0};Rect.prototype={stroke:function(t){t.save(),t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.closePath(),t.setStrokeStyle(this.strokeStyle),t.stroke(),t.restore()},fill:function(t){t.save(),t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.closePath(),t.setFillStyle(this.fillStyle),t.fill(),t.restore()},move:function(t,i){this.x=t,this.y=i},detected:function(t,i){var s=this;if(s.x<t&&s.y<i&&s.y+s.h>i&&s.x+s.w>t)return this._offsetX=t-s.x,this._offsetY=i-s.y,console.log("移动方块"),this._isChoosed=!0,!0},moveDetect:function(t,i){1==this._isChoosed&&this.move(t-this._offsetX,i-this._offsetY)},upDetect:function(){this._isChoosed=!1}};var Shape=function(t,i,s,e,h){this.draggable=!!e,this.highlight=!!h,this.strokeOrfill=!!s,this.type=t,this.Shape=new shapeTypes[t](i)};Shape.prototype={paint:function(t){this.strokeOrfill?this.Shape.fill(t):this.Shape.stroke(t)},detect:function(t,i){this.Shape.detected(t,i),this.Shape.detected(t,i)},moveDetect:function(t,i){this.Shape.moveDetect(t,i)},upDetect:function(){this.Shape.upDetect()}};var shapeTypes={circle:function(t){return new Circle(t)},rect:function(t){return new Rect(t)},polygon:function(t){return new Polygon(t)}},requestAnimationFrame=function(t){fakeAnimationFrame(t)};WxDraw.prototype={add:function(t){this.store.add(t)},draw:function(){this.store.store.forEach(function(t){t.paint(this.canvas)},this)},detect:function(t){var i=this.getLoc(t.touches[0].x,t.touches[0].y);this.store.store.forEach(function(t){t.detect(i.x,i.y)},this)},moveDetect:function(t){var i=this.getLoc(t.touches[0].x,t.touches[0].y);this.store.store.forEach(function(t){t.moveDetect(i.x,i.y),console.log("item",t)},this),this.draw(),this.canvas.draw()},upDetect:function(){this.store.store.forEach(function(t){t.upDetect()},this)},getLoc:function(t,i){return{x:t-this.x>0?t-this.x>this.w?this.w:t-this.x:this.x,y:i-this.y>0?i-this.y>this.h?this.h:i-this.y:this.y}}},module.exports={WxDraw:WxDraw,Shape:Shape,requestAnimationFrame:requestAnimationFrame};
